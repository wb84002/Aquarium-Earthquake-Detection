# 智能魚缸水位偵測系統（Visual Water Level Detector）

使用 **OpenCV + Tkinter + Matplotlib** 建立的魚缸水位偵測系統，

可從 **本地影片 / YouTube / 本地鏡頭** 取得影像，

自動偵測魚缸邊框（ROI）與水位線，計算水位百分比並記錄到 CSV，

當水位達到警告/危險門檻時可透過 **LINE Bot 推播通知**。

系統內建「儀表板」可載入 CSV 歷史資料，

顯示趨勢圖（含狀態區段）與警告/危險比例圓餅圖，

並支援多個 CSV 合併成一天趨勢。

---
## 開發環境
Python：3.13.11

IDE：VS Code

---

## 功能特色

- ✅ **自動偵測魚缸邊框（ROI）與水位線**
  - Canny 邊緣 + 最大輪廓找魚缸矩形
  - ROI 內使用 HoughLinesP 找水平水位線；若失敗則使用灰階差異法作為 fallback
- ✅ **水位計算與狀態判定**
  - 依魚缸高度換算水位百分比
  - 狀態：安全 / 警告 / 危險 / 未知
- ✅ **CSV 紀錄與日期分類**
  - 自動輸出到 `csv_data/YYYY-MM-DD/`
  - 每 10 幀記錄一次（可自行調整）
- ✅ **LINE Bot 推播通知（選用）**
  - 遇到警告/危險狀態推播
  - 內建通知間隔節流（避免短時間連續推播）
  - 可測試推播與查詢本月推播額度（若 SDK 支援）
- ✅ **Tkinter GUI（藍色海洋風格）**
  - 左側控制區 / 右側「狀態訊息、儀表板」
  - 可拖拉分隔線調整左右寬度（PanedWindow）
- ✅ **儀表板 Dashboard**
  - 水位歷史趨勢圖（含狀態底色區段）
  - 警告/危險比例圓餅圖
  - 可選多個 CSV 合併成「一天趨勢」

---

## 專案架構

```text
project/
├─ Aquarium Earthquake Detection.ipynb                         # 主程式（GUI + 偵測 + 儀表板）
├─ csv_data/
│  └─ YYYY-MM-DD/
│     ├─ water_level_log_*.csv      # 自動產生的紀錄檔
└─ README.md
```
---
## 啟動後 GUI 會分成：

左側：來源選擇、參數、LINE 設定、開始/停止

右側：狀態訊息、儀表板（趨勢圖/圓餅圖）

---
## 影片來源說明
- A. 本地影片檔案

選擇「本地影片檔案」

按「瀏覽」選擇 mp4/avi/mov/mkv...

按「開始分析」

- B. YouTube URL

選擇「YouTube URL」

貼上影片網址

按「開始分析」

系統會：

優先嘗試串流（OpenCV 直接讀 URL）

若串流不可用，改為下載暫存檔後播放（自動清理暫存檔）

- C. 本地鏡頭（Webcam / USB Camera）

選擇「本地鏡頭」

輸入鏡頭索引：

0：預設鏡頭

1：常見外接 USB Camera

按「開始分析」

---
## 參數設定

警告閾值 (%)：例如 90 → 水位達到 90% 判定為「警告」

危險閾值 (%)：例如 100 → 水位達到 100% 判定為「危險」

通知間隔 (秒)：LINE 推播最小間隔，避免短時間大量推播

---
## CSV 輸出與格式
輸出位置

  - csv_data/YYYY-MM-DD/water_level_log_YYYYMMDD_HHMMSS.csv

欄位

  - 時間

  - 影格編號

  - 魚缸頂端(px)

  - 水位線(px)

  - 水位高度(px)

  - 水位百分比(%)

  - 狀態（安全/警告/危險/未知）

  - 備註

---
## 儀表板使用方式

1.切換到右側「儀表板」分頁

2.選擇日期資料夾（YYYY-MM-DD）

3.在 CSV 列表：

  - 單選：顯示單一 CSV 趨勢

  - Ctrl / Shift 多選：合併多個 CSV 顯示「一天趨勢」

4.按「載入選取(繪圖)」或「載入最新」

## 顯示內容

  - 趨勢圖：水位百分比曲線 + 狀態底色區段
    - 安全/警告/危險/未知會以不同底色區段呈現

  - 圓餅圖：警告 / 危險比例（以資料筆數統計）

---
## LINE Bot 設定（選用）
需要的資料

  - Channel Access Token

  - User ID

填入後按「測試LINE」可：

  - 讀取並顯示本月推播額度（若 SDK/權限支援）

  - 推播一則測試訊息

若推播失敗或遇到 429 Too Many Requests，程式會避免短時間重複推播（並受通知間隔控制）。
